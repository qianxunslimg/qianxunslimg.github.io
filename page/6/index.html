<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="https://qianxunslimg.oss-cn-beijing.aliyuncs.com/img/MTMRB7P@G[WVCWEB9W([}FT.png">
  <link rel="icon" type="image/png" sizes="16x16" href="https://qianxunslimg.oss-cn-beijing.aliyuncs.com/img/MTMRB7P@G[WVCWEB9W([}FT.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"qianxunslimg.github.io","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"mac"},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.json"};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="qianxunslimgのblog">
<meta property="og:url" content="https://qianxunslimg.github.io/page/6/index.html">
<meta property="og:site_name" content="qianxunslimgのblog">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="qianxunslimg">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://qianxunslimg.github.io/page/6/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>qianxunslimgのblog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>


<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
<link rel="alternate" href="/atom.xml" title="qianxunslimgのblog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">qianxunslimgのblog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">TOLLM</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-首页">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-时间轴">

    <a href="/archives/" rel="section"><i class="fas fa-archive fa-fw"></i>时间轴</a>

  </li>
        <li class="menu-item menu-item-标签">

    <a href="/tags/" rel="section"><i class="fas fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-分类">

    <a href="/categories/" rel="section"><i class="fas fa-folder-open fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-友链">

    <a href="/link/" rel="section"><i class="fas fa-link fa-fw"></i>友链</a>

  </li>
        <li class="menu-item menu-item-关于">

    <a href="/about/" rel="section"><i class="fas fa-heart fa-fw"></i>关于</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="reading-progress-bar"></div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://qianxunslimg.github.io/2021/12/02/qt-da-bao-cheng-xu/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="qianxunslimg">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="qianxunslimgのblog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/12/02/qt-da-bao-cheng-xu/" class="post-title-link" itemprop="url">QT打包程序</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-12-02 19:17:36" itemprop="dateCreated datePublished" datetime="2021-12-02T19:17:36+08:00">2021-12-02</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-04-22 23:48:13" itemprop="dateModified" datetime="2022-04-22T23:48:13+08:00">2022-04-22</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="1-发布release版本的QT程序"><a href="#1-发布release版本的QT程序" class="headerlink" title="1.发布release版本的QT程序"></a>1.发布release版本的QT程序</h2><p>　　在build release文件夹内找到exe文件，将其单独放在一个自建的空文件夹内</p>
<p><img src="https://qianxunslimg.oss-cn-beijing.aliyuncs.com/img/2092994-20200927165117303-604984762.png"></p>
<p><img src="https://qianxunslimg.oss-cn-beijing.aliyuncs.com/img/2092994-20200927165455009-910788885.png"></p>
<p>&amp;nbsp;</p>
<p>&amp;nbsp;</p>
<p>&amp;nbsp;</p>
<h2 id="amp-nbsp-2-cd到含exe的空文件夹"><a href="#amp-nbsp-2-cd到含exe的空文件夹" class="headerlink" title="&amp;nbsp;2.cd到含exe的空文件夹"></a>&amp;nbsp;2.cd到含exe的空文件夹</h2><p>　　在QT命令行cd到含exe的空文件夹，cd /d E:\QDIR</p>
<p><img src="https://qianxunslimg.oss-cn-beijing.aliyuncs.com/img/2092994-20200927165604874-1233279110.png"><img src="https://img2020.cnblogs.com/blog/2092994/202009/2092994-20200927165951305-446477392.png"></p>
<h2 id="3-使用windeployqt-exe进行打包"><a href="#3-使用windeployqt-exe进行打包" class="headerlink" title="3.使用windeployqt.exe进行打包"></a>3.使用windeployqt.exe进行打包</h2><p>首先找到windeployqt.exe的路径&amp;nbsp;</p>
<p>&amp;nbsp;<img src="https://qianxunslimg.oss-cn-beijing.aliyuncs.com/img/2092994-20200927170127591-1210427907.png"></p>
<p>&amp;nbsp;</p>
<p>&amp;nbsp;</p>
<p>输入命令D:\QT\5.14.2\msvc2017_64\bin\windeployqt&amp;nbsp;QDIR.exe即完成了打包</p>
<p><img src="https://qianxunslimg.oss-cn-beijing.aliyuncs.com/img/2092994-20200927170421891-1644738339.png"><img src="https://qianxunslimg.oss-cn-beijing.aliyuncs.com/img/2092994-20200927170550570-2063963822.png"></p>
<p>&amp;nbsp;</p>
<h2 id="amp-nbsp-附：打包前修改exe图标"><a href="#amp-nbsp-附：打包前修改exe图标" class="headerlink" title="&amp;nbsp;附：打包前修改exe图标"></a>&amp;nbsp;附：打包前修改exe图标</h2><h2 id="改变exe的图标"><a href="#改变exe的图标" class="headerlink" title="改变exe的图标"></a>改变exe的图标</h2><p>1、下载一个.ico格式的图标（如：bucket and shovel.ico），将bucket and shovel.ico复制到工程目录下。</p>
<p><img src="https://qianxunslimg.oss-cn-beijing.aliyuncs.com/img/2092994-20200927172502714-1388114573.png"></p>
<p>&amp;nbsp;</p>
<p>&amp;nbsp;</p>
<p>2、工程目录下新建一个空白txt文档，文档内添加如下内容<br><code>IDI_ICON1 ICON DISCARDABLE "bucket and shovel.ico"</code><br>3、将文档后缀修改为.rc（如：bucke.rc, !!注意!!rc文件名不要含空格）&amp;nbsp;<br>4、在工程的pro文件添加如下内容<br><code>RC_FILE = bucket.rc</code><br>5、重新编译程序，即可发现生成的程序图标变成了bucket.ico</p>
<p><img src="https://qianxunslimg.oss-cn-beijing.aliyuncs.com/img/2092994-20200927172701527-227417489.png"></p>
<p>&amp;nbsp;</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://qianxunslimg.github.io/2021/12/02/qstring-jie-duan-string-jie-duan/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="qianxunslimg">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="qianxunslimgのblog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/12/02/qstring-jie-duan-string-jie-duan/" class="post-title-link" itemprop="url">QString截断（string截断）</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-12-02 19:16:42" itemprop="dateCreated datePublished" datetime="2021-12-02T19:16:42+08:00">2021-12-02</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-04-23 00:20:48" itemprop="dateModified" datetime="2022-04-23T00:20:48+08:00">2022-04-23</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="最近写一个Qt小程序用到了QString的截断，在绝对路径中取文件的名字，再拼接到新路径中，用到了两个方法："><a href="#最近写一个Qt小程序用到了QString的截断，在绝对路径中取文件的名字，再拼接到新路径中，用到了两个方法：" class="headerlink" title="最近写一个Qt小程序用到了QString的截断，在绝对路径中取文件的名字，再拼接到新路径中，用到了两个方法："></a>最近写一个Qt小程序用到了QString的截断，在绝对路径中取文件的名字，再拼接到新路径中，用到了两个方法：</h4><h3 id="方法一：由于对QString没有深入了解，所以采用的QString–-gt-string–-gt-QString，代码如下："><a href="#方法一：由于对QString没有深入了解，所以采用的QString–-gt-string–-gt-QString，代码如下：" class="headerlink" title="方法一：由于对QString没有深入了解，所以采用的QString–>string–>QString，代码如下："></a>方法一：由于对QString没有深入了解，所以采用的QString–&gt;string–&gt;QString，代码如下：</h3><figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">std::string pur = purposelist[i].<span class="built_in">toStdString</span>();<span class="comment">//都转换为string</span></span><br><span class="line"><span class="comment">// qDebug()&lt;&lt;pur&lt;&lt;endl;</span></span><br><span class="line">std::string sdir = dstpath.<span class="built_in">toStdString</span>();</span><br><span class="line"><span class="keyword">int</span> pos = pur.<span class="built_in">find_last_of</span>(<span class="string">'/'</span>); <span class="comment">//找到最后/</span></span><br><span class="line"><span class="function">std::string <span class="title">s</span><span class="params">(pur.substr(pos + <span class="number">1</span>))</span></span>;</span><br><span class="line">sdir.<span class="built_in">append</span>(<span class="string">"/"</span>);</span><br><span class="line">sdir.<span class="built_in">append</span>(s);</span><br><span class="line">QString qsdir = <span class="built_in">QString</span>(QString::<span class="built_in">fromLocal8Bit</span>(sdir.<span class="built_in">c_str</span>()));</span><br><span class="line"><span class="built_in">qDebug</span>() &lt;&lt; qsdir &lt;&lt; endl;</span><br></pre></td></tr></tbody></table></figure>



<h3 id="用这种方法出现的问题是，string中的中文字符转到QString会乱码…"><a href="#用这种方法出现的问题是，string中的中文字符转到QString会乱码…" class="headerlink" title="用这种方法出现的问题是，string中的中文字符转到QString会乱码…"></a>用这种方法出现的问题是，string中的中文字符转到QString会乱码…</h3><p>&amp;nbsp;</p>
<h3 id="方法二：QString直接进行截断拼接"><a href="#方法二：QString直接进行截断拼接" class="headerlink" title="方法二：QString直接进行截断拼接"></a>方法二：QString直接进行截断拼接</h3><figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//QString截断学习</span></span><br><span class="line"><span class="function">QString <span class="title">src</span><span class="params">(<span class="string">"E:/qq接收文件/MobileFile/thumb/碎裂收据.jpg"</span>)</span></span>;</span><br><span class="line"><span class="built_in">qDebug</span>()&lt;&lt;<span class="string">"original path: "</span>&lt;&lt;src&lt;&lt;endl;</span><br><span class="line"><span class="function">QString <span class="title">dir</span><span class="params">(<span class="string">"E:/目标文件夹"</span>)</span></span>;</span><br><span class="line"><span class="built_in">qDebug</span>()&lt;&lt;<span class="string">"the last string '/' pos is "</span>&lt;&lt;src.<span class="built_in">lastIndexOf</span>(<span class="string">'/'</span>)&lt;&lt;endl;</span><br><span class="line">QString filename = src.<span class="built_in">right</span>(src.<span class="built_in">size</span>() - (src.<span class="built_in">lastIndexOf</span>(<span class="string">"/"</span>)+<span class="number">1</span>));</span><br><span class="line"><span class="built_in">qDebug</span>()&lt;&lt;<span class="string">"the true filename is "</span>&lt;&lt;filename&lt;&lt;endl;</span><br></pre></td></tr></tbody></table></figure>

<h3 id="复盘，刚接触qt的自己好蠢，事实上-qstring可能是c-下最好用的string了"><a href="#复盘，刚接触qt的自己好蠢，事实上-qstring可能是c-下最好用的string了" class="headerlink" title="复盘，刚接触qt的自己好蠢，事实上 qstring可能是c++下最好用的string了"></a>复盘，刚接触qt的自己好蠢，事实上 qstring可能是c++下最好用的string了</h3><p>QString存储字符串采用的是Unicode码,每一个字符是一个十六位的QChar, 而不是八位的char, 所以处理中文字符没有问题, 而且一个汉字是一个字符。</p>
<h4 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h4><p><strong>1、append()和prepend()</strong></p>
<p>append()在字符串后面添加字符串,prepend()在字符串前面添加字符串。</p>
<p>如下：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">QString str1="卖", str2 = "拐";</span><br><span class="line">str1 = str1.append(str2);	//"卖拐"</span><br><span class="line">str2 = str2.prepend(str1);	//"拐卖"</span><br></pre></td></tr></tbody></table></figure>

<p><strong>2、toUpper()和toLower()</strong></p>
<p>toUpper()是将字符串中的字母全部转化为大写字母,toLower()是将所有的字母全部转化为小写字母。</p>
<p>如下：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">QString str1 = "Hello World", str2;</span><br><span class="line">str2 = str1.toUpper();	//"HELLO WORLD"</span><br><span class="line">str2 = str1.toLower();	//"hello world"</span><br></pre></td></tr></tbody></table></figure>

<p><strong>3、cont()、size()和length()</strong></p>
<p>count()、size()和length()这三个函数都是返回字符串的个数的,这3个函数是相同的。注意：一个汉字算是一个字符</p>
<p>如下：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">QString str = "NI 好";</span><br><span class="line">N = str.count();	//N == 3</span><br><span class="line">N = str.size();		//N == 3</span><br><span class="line">N = str.length();	//N == 3</span><br></pre></td></tr></tbody></table></figure>

<p><strong>4、trimmed()和simplified()</strong></p>
<p>trimmed()是去掉字符串首尾的空格,simplified()不仅去掉首尾的空格,中间连续的空格也能用一个空格替换。</p>
<p>如下：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">QString str1 = " Are    you  ok?   ";</span><br><span class="line">str2 = str1.trimmed();		//"Are    you  ok?"</span><br><span class="line">str2 = str1.simplified()	//"Are you ok?"</span><br></pre></td></tr></tbody></table></figure>

<p><strong>5、indexOf()和lastIndexOf()</strong></p>
<p>查找字符串的位置</p>
<p>如下：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">QString str1 = "G:\Qt5Book\Qt5.9Study\qw.cpp";</span><br><span class="line">N = str1.indexOf("5.9");			//N == 13</span><br><span class="line">N = str1.lastIndexOf("\\");			//N == 21</span><br><span class="line">注意："\"是转义字符,如果要查找"\",需要输入"\\"</span><br></pre></td></tr></tbody></table></figure>

<p><strong>6、isNull()和isEmpty()</strong></p>
<p>这两个函数都用来判断字符串是否为空,但是稍微有差别。如果一个空字符串,只有”\0”,isNull()返回false,而isEmpty()返回true;只有未赋值的字符串,isNull()才返回true。</p>
<p>如下：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">QString str1, str2="";</span><br><span class="line">N = str1.isNull();	//true	未赋值字符串变量</span><br><span class="line">N = str2.isNull();	//false	只有"\0"的字符串,也不是Null</span><br><span class="line">N = str1.isEmpty(); //true</span><br><span class="line">N = str2.isEmpty(); //true</span><br></pre></td></tr></tbody></table></figure>

<p><strong>7、contains()</strong></p>
<p>判断字符串内是否包含某个字符,可指定是否区分大小写。</p>
<p>如下：</p>
<figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">QString str1 = <span class="string">"G:\Qt5Book\Qt5.9Study\qw.cpp"</span>;</span><br><span class="line">N = str1.<span class="built_in">contains</span>(<span class="string">".cpp"</span>, Qt::CaseInsensitive);		<span class="comment">//true 不区分大小写	</span></span><br><span class="line">N = str1.<span class="built_in">contains</span>(<span class="string">".CPP"</span>, Qt::CaseSensitive);		<span class="comment">//false 区分大小写</span></span><br></pre></td></tr></tbody></table></figure>

<p><strong>8、endsWith()和startsWith()</strong></p>
<p>startsWith()判断是否以某个字符串开头,endsWith()表示是否以某个字符串结尾。</p>
<p>如下：</p>
<figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">QString str1 = <span class="string">"G:\Qt5Book\Qt5.9Study\qw.cpp"</span>;</span><br><span class="line">N = str1.<span class="built_in">endsWith</span>(<span class="string">".cpp"</span>, Qt::CaseInsensitive);		<span class="comment">//true 不区分大小写	</span></span><br><span class="line">N = str1.<span class="built_in">endsWith</span>(<span class="string">".CPP"</span>, Qt::CaseSensitive);		<span class="comment">//false 区分大小写</span></span><br><span class="line">N = str.<span class="built_in">startsWith</span>(<span class="string">"g:"</span>);							<span class="comment">//true 缺省为不区分大小写</span></span><br></pre></td></tr></tbody></table></figure>

<p><strong>9、left()和right()</strong></p>
<p>left()表示取一个字符串左边多少个字符,right()表示取一个字符串右边多少个字符。注意：一个汉字被当作一个字符;</p>
<figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">QString str2, str1=<span class="string">"学生姓名, 男, 1984-3-4, 汉族, 山东"</span>;</span><br><span class="line">N = str1.<span class="built_in">indexOf</span>(<span class="string">","</span>);					<span class="comment">//N == 4,第一个","出现的位置</span></span><br><span class="line">str2 = str1.<span class="built_in">left</span>(N);					<span class="comment">//str2 == "学生姓名"</span></span><br><span class="line">N = str1.<span class="built_in">lastIndexOf</span>(<span class="string">","</span>);				<span class="comment">//N ==18,最后一个逗号出现的位置</span></span><br><span class="line">str2 = str1.<span class="built_in">right</span>(str1.<span class="built_in">size</span>()-N<span class="number">-1</span>);		<span class="comment">//str2 = "山东",提取最后一个逗号之间的字符串</span></span><br></pre></td></tr></tbody></table></figure>

<p><strong>10、section()</strong></p>
<p>从字符串中提取以se为分隔符,从start到end的字符串。</p>
<figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">QString str1 = <span class="string">"G:\Qt5Book\Qt5.9Study\qw.cpp"</span>, str2;</span><br><span class="line">str2 = str1.<span class="built_in">section</span>(<span class="string">","</span>,<span class="number">0</span>,<span class="number">0</span>);	<span class="comment">//str2 == "学生姓名"</span></span><br><span class="line">str2 = str1.<span class="built_in">section</span>(<span class="string">","</span>,<span class="number">1</span>,<span class="number">1</span>);	<span class="comment">//str2 == "男"</span></span><br><span class="line">str2 = str1.<span class="built_in">section</span>(<span class="string">","</span>,<span class="number">0</span>,<span class="number">1</span>);	<span class="comment">//str2 == "学生姓名,男"</span></span><br><span class="line">str2 = str1.<span class="built_in">section</span>(<span class="string">","</span>,<span class="number">4</span>,<span class="number">4</span>);	<span class="comment">//str2 == "山东"</span></span><br></pre></td></tr></tbody></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://qianxunslimg.github.io/2021/12/02/jian-dan-de-hua-dong-chuang-kou-643-zi-shu-zu-zui-da-ping-jun-shu-i/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="qianxunslimg">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="qianxunslimgのblog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/12/02/jian-dan-de-hua-dong-chuang-kou-643-zi-shu-zu-zui-da-ping-jun-shu-i/" class="post-title-link" itemprop="url">简单的滑动窗口 643. 子数组最大平均数 I</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-12-02 19:13:48" itemprop="dateCreated datePublished" datetime="2021-12-02T19:13:48+08:00">2021-12-02</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-03-16 00:18:55" itemprop="dateModified" datetime="2022-03-16T00:18:55+08:00">2022-03-16</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>给你一个由 n 个元素组成的整数数组 nums 和一个整数 k 。</p>
<p>请你找出平均数最大且 长度为 k 的连续子数组，并输出该最大平均数。</p>
<p>任何误差小于 10-5 的答案都将被视为正确答案。</p>
<p>&amp;nbsp;</p>
<p>示例 1：</p>
<p>输入：nums = [1,12,-5,-6,50,3], k = 4<br>输出：12.75<br>解释：最大平均数 (12-5-6+50)/4 = 51/4 = 12.75<br>示例 2：</p>
<p>输入：nums = [5], k = 1<br>输出：5.00000</p>
<div class="cnblogs_code">
<pre><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> Solution {
</span><span style="color: #008080;"> 2</span> <span style="color: #0000ff;">public</span><span style="color: #000000;">:
</span><span style="color: #008080;"> 3</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> double findMaxAverage(vector&lt;int&gt;&amp; nums, int k) {
</span><span style="color: #008080;"> 4</span>     <span style="color: #008000;">//</span><span style="color: #008000;">     double res = -10000.0;
</span><span style="color: #008080;"> 5</span>     <span style="color: #008000;">//</span><span style="color: #008000;">     double sum = 0;
</span><span style="color: #008080;"> 6</span>     <span style="color: #008000;">//</span><span style="color: #008000;">     double ave;
</span><span style="color: #008080;"> 7</span>     <span style="color: #008000;">//</span><span style="color: #008000;">     for(int i = 0; i&lt;=nums.size()-k; i++){
</span><span style="color: #008080;"> 8</span>     <span style="color: #008000;">//</span><span style="color: #008000;">         if( i == 0){
</span><span style="color: #008080;"> 9</span>     <span style="color: #008000;">//</span><span style="color: #008000;">             for(int j = 0; j&lt;k; j++){
</span><span style="color: #008080;">10</span>     <span style="color: #008000;">//</span><span style="color: #008000;">                 sum+=nums[i+j];
</span><span style="color: #008080;">11</span>     <span style="color: #008000;">//</span><span style="color: #008000;">             }
</span><span style="color: #008080;">12</span>     <span style="color: #008000;">//</span><span style="color: #008000;">         }else{
</span><span style="color: #008080;">13</span>     <span style="color: #008000;">//</span><span style="color: #008000;">             sum-=nums[i-1];
</span><span style="color: #008080;">14</span>     <span style="color: #008000;">//</span><span style="color: #008000;">             sum+=nums[i+k-1];
</span><span style="color: #008080;">15</span>     <span style="color: #008000;">//</span><span style="color: #008000;">         }
</span><span style="color: #008080;">16</span>     <span style="color: #008000;">//</span><span style="color: #008000;">         ave = sum/k;
</span><span style="color: #008080;">17</span>     <span style="color: #008000;">//</span><span style="color: #008000;">         cout &lt;&lt;ave&lt;&lt;endl;
</span><span style="color: #008080;">18</span>     <span style="color: #008000;">//</span><span style="color: #008000;">         res = res&gt;ave?res:ave;
</span><span style="color: #008080;">19</span>     <span style="color: #008000;">//</span><span style="color: #008000;">     }
</span><span style="color: #008080;">20</span>     <span style="color: #008000;">//</span><span style="color: #008000;">     return res;
</span><span style="color: #008080;">21</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> }</span>
<span style="color: #008080;">22</span>     <span style="color: #0000ff;">double</span> findMaxAverage(vector&lt;<span style="color: #0000ff;">int</span>&gt;&amp; nums, <span style="color: #0000ff;">int</span><span style="color: #000000;"> k) {
</span><span style="color: #008080;">23</span>         <span style="color: #0000ff;">int</span> sum = <span style="color: #800080;">0</span><span style="color: #000000;">;
</span><span style="color: #008080;">24</span>         <span style="color: #0000ff;">int</span> n =<span style="color: #000000;"> nums.size();
</span><span style="color: #008080;">25</span>         <span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">int</span> i = <span style="color: #800080;">0</span>; i &lt; k; i++<span style="color: #000000;">) {
</span><span style="color: #008080;">26</span>             sum +=<span style="color: #000000;"> nums[i];
</span><span style="color: #008080;">27</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">28</span>         <span style="color: #0000ff;">int</span> maxSum =<span style="color: #000000;"> sum;
</span><span style="color: #008080;">29</span>         <span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">int</span> i = k; i &lt; n; i++<span style="color: #000000;">) {
</span><span style="color: #008080;">30</span>             sum = sum - nums[i - k] +<span style="color: #000000;"> nums[i];
</span><span style="color: #008080;">31</span>             maxSum =<span style="color: #000000;"> max(maxSum, sum);
</span><span style="color: #008080;">32</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">33</span>         <span style="color: #0000ff;">return</span> static_cast&lt;<span style="color: #0000ff;">double</span>&gt;(maxSum) /<span style="color: #000000;"> k;
</span><span style="color: #008080;">34</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">35</span> 
<span style="color: #008080;">36</span> };</pre>
</div>

<p>&amp;nbsp;</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://qianxunslimg.github.io/2021/12/02/tu-pian-ping-hua-qi/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="qianxunslimg">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="qianxunslimgのblog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/12/02/tu-pian-ping-hua-qi/" class="post-title-link" itemprop="url">图片平滑器</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2021-12-02 19:11:08 / 修改时间：19:12:00" itemprop="dateCreated datePublished" datetime="2021-12-02T19:11:08+08:00">2021-12-02</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>包含整数的二维矩阵 M 表示一个图片的灰度。你需要设计一个平滑器来让每一个单元的灰度成为平均灰度&amp;nbsp;(向下舍入) ，平均灰度的计算是周围的8个单元和它本身的值求平均，如果周围的单元格不足八个，则尽可能多的利用它们。</p>
<p>示例 1:</p>
<p>输入:<br>[[1,1,1],<br> [1,0,1],<br> [1,1,1]]<br>输出:<br>[[0, 0, 0],<br> [0, 0, 0],<br> [0, 0, 0]]<br>解释:<br>对于点 (0,0), (0,2), (2,0), (2,2): 平均(3/4) = 平均(0.75) = 0<br>对于点 (0,1), (1,0), (1,2), (2,1): 平均(5/6) = 平均(0.83333333) = 0<br>对于点 (1,1): 平均(8/9) = 平均(0.88888889) = 0</p>
<div class="cnblogs_code">
<pre><span style="color: #008080;"> 1</span>     vector&lt;vector&lt;<span style="color: #0000ff;">int</span>&gt;&gt; imageSmoother(vector&lt;vector&lt;<span style="color: #0000ff;">int</span>&gt;&gt;&amp;<span style="color: #000000;"> img) {
</span><span style="color: #008080;"> 2</span>         <span style="color: #0000ff;">const</span> <span style="color: #0000ff;">int</span> n =<span style="color: #000000;"> img.size();
</span><span style="color: #008080;"> 3</span>         <span style="color: #0000ff;">const</span> <span style="color: #0000ff;">int</span> m = img[<span style="color: #800080;">0</span><span style="color: #000000;">].size();
</span><span style="color: #008080;"> 4</span>         vector&lt;vector&lt;<span style="color: #0000ff;">int</span>&gt;&gt; ans(n, vector&lt;<span style="color: #0000ff;">int</span>&gt;<span style="color: #000000;">(m));
</span><span style="color: #008080;"> 5</span>         <span style="color: #0000ff;">for</span>(<span style="color: #0000ff;">int</span> i = <span style="color: #800080;">0</span>; i &lt; n; ++i){  <span style="color: #008000;">//</span><span style="color: #008000;">遍历每一个点</span>
<span style="color: #008080;"> 6</span>             <span style="color: #0000ff;">for</span>(<span style="color: #0000ff;">int</span> j = <span style="color: #800080;">0</span>; j &lt; m; ++<span style="color: #000000;">j){
</span><span style="color: #008080;"> 7</span>                 <span style="color: #0000ff;">int</span> sum = <span style="color: #800080;">0</span>, num = <span style="color: #800080;">0</span><span style="color: #000000;">;
</span><span style="color: #008080;"> 8</span>                 <span style="color: #0000ff;">for</span>(<span style="color: #0000ff;">int</span> k = -<span style="color: #800080;">1</span>; k &lt;= <span style="color: #800080;">1</span>; ++k){  <span style="color: #008000;">//</span><span style="color: #008000;">遍历周围的格子</span>
<span style="color: #008080;"> 9</span>                     <span style="color: #0000ff;">for</span>(<span style="color: #0000ff;">int</span> l = -<span style="color: #800080;">1</span>; l &lt;= <span style="color: #800080;">1</span>; ++l){   <span style="color: #008000;">//</span><span style="color: #008000;">判断是否出界</span>
<span style="color: #008080;">10</span>                         <span style="color: #0000ff;">if</span>(i + k &gt;= <span style="color: #800080;">0</span> &amp;&amp; i + k &lt; n &amp;&amp; j + l &gt;= <span style="color: #800080;">0</span> &amp;&amp; j + l &lt;<span style="color: #000000;"> m){
</span><span style="color: #008080;">11</span>                             ++num; <span style="color: #008000;">//</span><span style="color: #008000;">没有出界，格子个数+1</span>
<span style="color: #008080;">12</span>                             sum += img[i + k][j + l]; <span style="color: #008000;">//</span><span style="color: #008000;">计算总和</span>
<span style="color: #008080;">13</span> <span style="color: #000000;">                        }
</span><span style="color: #008080;">14</span> <span style="color: #000000;">                    }
</span><span style="color: #008080;">15</span> <span style="color: #000000;">                }
</span><span style="color: #008080;">16</span>                 ans[i][j] = sum / num; <span style="color: #008000;">//</span><span style="color: #008000;">计算平均值</span>
<span style="color: #008080;">17</span> <span style="color: #000000;">            }
</span><span style="color: #008080;">18</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">19</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;"> ans;
</span><span style="color: #008080;">20</span>     }</pre>
</div>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://qianxunslimg.github.io/2021/12/02/ubantu-sou-gou-shu-ru-fa-hou-xuan-han-zi-luan-ma/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="qianxunslimg">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="qianxunslimgのblog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/12/02/ubantu-sou-gou-shu-ru-fa-hou-xuan-han-zi-luan-ma/" class="post-title-link" itemprop="url">Ubantu搜狗输入法候选汉字乱码</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-12-02 19:07:54" itemprop="dateCreated datePublished" datetime="2021-12-02T19:07:54+08:00">2021-12-02</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-04-22 23:47:42" itemprop="dateModified" datetime="2022-04-22T23:47:42+08:00">2022-04-22</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Ubantu搜狗输入法候选汉字乱码</p>
<p>可能原因，自己手贱删除了/etc/apt/sources.list.d中的fcitx的一个列表</p>
<p>&amp;nbsp;</p>
<p>解决方法：</p>
<p><img src="https://qianxunslimg.oss-cn-beijing.aliyuncs.com/img/2092994-20200813170919380-560000114.png"></p>
<p>&amp;nbsp;</p>
<p>&amp;nbsp;配置当前输入发，将搜狗输入法下移放在第二个位置（MDZZ）</p>
<p><img src="https://qianxunslimg.oss-cn-beijing.aliyuncs.com/img/2092994-20200813171020437-1675339877.png"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://qianxunslimg.github.io/2021/10/02/vs-cheng-xu-copy-dao-qt-de-ruo-gan-cuo-wu/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="qianxunslimg">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="qianxunslimgのblog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/10/02/vs-cheng-xu-copy-dao-qt-de-ruo-gan-cuo-wu/" class="post-title-link" itemprop="url">vs程序 copy 到Qt的若干错误</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-10-02 19:37:11" itemprop="dateCreated datePublished" datetime="2021-10-02T19:37:11+08:00">2021-10-02</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-04-23 00:29:20" itemprop="dateModified" datetime="2022-04-23T00:29:20+08:00">2022-04-23</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="vs程序-copy-到Qt的若干错误"><a href="#vs程序-copy-到Qt的若干错误" class="headerlink" title="vs程序 copy 到Qt的若干错误"></a><a target="_blank" rel="noopener" href="https://www.cnblogs.com/qianxunslimg/p/14347565.html">vs程序 copy 到Qt的若干错误</a></h1><p>打杂人的苦恼：</p>
<ul>
<li>发票太多ofd的 sunny只要pdf的 ofd只能用某个国产软件打开</li>
<li>某国产软件过于拉跨，无法直接转为pdf 只能认为截图 word 另存为…</li>
<li>ofd的编码格式搞清楚有点费劲 但是想到了一个笨方法<ol>
<li>调用某软件打开ofd文档</li>
<li>整体截图 使用opencv提取roi为发票区域</li>
<li>基于QT强大的模块化能力 直接存储为pdf</li>
</ol>
</li>
</ul>
<p>唉 在vs下学习了一些基础的操作 打算到qt下编写（当时还没有用qtvstools），不熟悉qtCreator 出现了一些问题</p>
<h4 id="菜归菜，还是学到一些东西"><a href="#菜归菜，还是学到一些东西" class="headerlink" title="菜归菜，还是学到一些东西"></a>菜归菜，还是学到一些东西</h4><ol>
<li><p>首先是windows.h在qt下的使用  LIBS +=User32.LIB</p>
</li>
<li><p>离谱的 dependent error .h does not exist  </p>
<p>看网上说的是.pro文件存在缓存？解决方案：瞎jb乱摁</p>
<p>通过以下步骤乱搞：</p>
<p>​       （1）ctrl A ctrlX .pro文件，编译，ctrl v编译</p>
<p>​        （2）删除相关头文件及代码的使用，重新添加并编译（傻逼操作）</p>
</li>
<li><p>无法解析的外部符号 __imp_DeleteObject 等等， 解决方法</p>
</li>
</ol>
<p>　　#pragma comment(lib, “Gdi32.lib”)</p>
<ol start="4">
<li><p>Cmd命令无法进行直接调用  system(“start C:\Users\00\Desktop\发票\1.24-\思巴克72.ofd”);</p>
<p>解决方法：使用QProcess运行cmd命令  <a target="_blank" rel="noopener" href="https://blog.csdn.net/vample/article/details/78872587">https://blog.csdn.net/vample/article/details/78872587</a></p>
</li>
</ol>
<p>啊呸，直接打开文件搞什么逼逼赖赖</p>
<figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">QString fileName = <span class="string">"C:\\Users\\00\\Desktop\\发票\\1.24-\\思巴克72.ofd"</span>;</span><br><span class="line"><span class="function">QFile <span class="title">file</span><span class="params">(fileName)</span></span>;</span><br><span class="line"><span class="keyword">if</span>(file.<span class="built_in">exists</span>()){</span><br><span class="line">    QDesktopServices::<span class="built_in">openUrl</span>(QUrl::<span class="built_in">fromLocalFile</span>(fileName));</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>　　</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://qianxunslimg.github.io/2021/09/26/mfc-du-qu-duo-ge-wen-jian/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="qianxunslimg">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="qianxunslimgのblog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/09/26/mfc-du-qu-duo-ge-wen-jian/" class="post-title-link" itemprop="url">MFC读取多个文件</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-09-26 19:28:00" itemprop="dateCreated datePublished" datetime="2021-09-26T19:28:00+08:00">2021-09-26</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-04-24 17:07:41" itemprop="dateModified" datetime="2022-04-24T17:07:41+08:00">2022-04-24</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="起因"><a href="#起因" class="headerlink" title="起因"></a>起因</h4><p>本身软件的文件读取逻辑是csv存储工程测点路径 然后根据路径去指定目录下找指定格式的文件读取 这个文件逻辑也是我们的采集设备采集完成后，结果文件的保存逻辑</p>
<p>奈何甲方使用习惯不同，习惯ctrl A全选 所有文件放在一个文件夹下和csv匹配，只好添加此逻辑</p>
<p>实现过程中，按照网上的方法，发现mfc的CFileDialog读取多个文件有个最大数量的限制，选的多，实际读取到的并不全</p>
<h4 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h4><p>设置CFileDialog的相关属性</p>
<figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">allDisp.<span class="built_in">clear</span>();</span><br><span class="line"><span class="keyword">if</span> (!m_sparkFile) <span class="comment">// liu的文件逻辑</span></span><br><span class="line">{</span><br><span class="line">  <span class="comment">// dlg.InitList(strFileName, m_listSource);</span></span><br><span class="line">  <span class="function">CFileDialog <span class="title">alldlg</span><span class="params">(TRUE, <span class="literal">NULL</span>, <span class="literal">NULL</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">                     OFN_HIDEREADONLY | OFN_OVERWRITEPROMPT |</span></span></span><br><span class="line"><span class="params"><span class="function">                         OFN_ALLOWMULTISELECT | OFN_EXPLORER,</span></span></span><br><span class="line"><span class="params"><span class="function">                     _T(<span class="string">"Disp(*disp)|*.disp||"</span>))</span></span>;</span><br><span class="line">  <span class="comment">//添加这些</span></span><br><span class="line"><span class="comment">//////////////////////////////////////////</span></span><br><span class="line">  DWORD MAXFILE = <span class="number">4000</span>;</span><br><span class="line">  alldlg.m_ofn.nMaxFile = MAXFILE;</span><br><span class="line">  <span class="keyword">char</span> *pc = <span class="keyword">new</span> <span class="keyword">char</span>[MAXFILE];</span><br><span class="line">  alldlg.m_ofn.lpstrFile = pc;</span><br><span class="line">  alldlg.m_ofn.lpstrFile[<span class="number">0</span>] = <span class="literal">NULL</span>;</span><br><span class="line"><span class="comment">//////////////////////////////////////////</span></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span> (IDOK != alldlg.<span class="built_in">DoModal</span>())</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">  POSITION pos = alldlg.<span class="built_in">GetStartPosition</span>();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> (pos) {</span><br><span class="line">    allDisp.<span class="built_in">insert</span>(alldlg.<span class="built_in">GetNextPathName</span>(pos));</span><br><span class="line">  }</span><br><span class="line">  dispPath = alldlg.<span class="built_in">GetPathName</span>();</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://qianxunslimg.github.io/2021/09/26/opencv-tian-jia-han-zi/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="qianxunslimg">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="qianxunslimgのblog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/09/26/opencv-tian-jia-han-zi/" class="post-title-link" itemprop="url">opencv添加汉字</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-09-26 19:28:00" itemprop="dateCreated datePublished" datetime="2021-09-26T19:28:00+08:00">2021-09-26</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-04-24 18:06:28" itemprop="dateModified" datetime="2022-04-24T18:06:28+08:00">2022-04-24</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="起因"><a href="#起因" class="headerlink" title="起因"></a>起因</h4><p>opencv的mat图片上 如果添加非中午字符 或者英文的话 使用opencv自带的putText就可以满足需求</p>
<p>但是添加汉字的话 putText就会出现问题</p>
<p>可以使用如下函数 在mat上添加汉字</p>
<h4 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h4><figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">putTextZH</span><span class="params">(Mat &amp;dst, <span class="keyword">const</span> <span class="keyword">char</span> *str, Point org, Scalar color, <span class="keyword">int</span> fontsize,</span></span></span><br><span class="line"><span class="params"><span class="function">               <span class="keyword">const</span> <span class="keyword">char</span> *fn, <span class="keyword">bool</span> italic, <span class="keyword">bool</span> underline)</span> </span>{</span><br><span class="line">  <span class="built_in">CV_Assert</span>(dst.data != <span class="number">0</span> &amp;&amp; (dst.<span class="built_in">channels</span>() == <span class="number">1</span> || dst.<span class="built_in">channels</span>() == <span class="number">3</span>));</span><br><span class="line"></span><br><span class="line">  <span class="keyword">int</span> x, y, r, b;</span><br><span class="line">  <span class="comment">//坐标点大于图像宽和高直接返回</span></span><br><span class="line">  <span class="keyword">if</span> (org.x &gt; dst.cols || org.y &gt; dst.rows)</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  x = org.x &lt; <span class="number">0</span> ? -org.x : <span class="number">0</span>;</span><br><span class="line">  y = org.y &lt; <span class="number">0</span> ? -org.y : <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  LOGFONTA lf;</span><br><span class="line">  lf.lfHeight = -fontsize;        <span class="comment">//字体高度</span></span><br><span class="line">  lf.lfWidth = <span class="number">0</span>;                 <span class="comment">//平均宽度</span></span><br><span class="line">  lf.lfEscapement = <span class="number">0</span>;            <span class="comment">//字符排列角度</span></span><br><span class="line">  lf.lfOrientation = <span class="number">0</span>;           <span class="comment">//字符本身旋转的角度</span></span><br><span class="line">  lf.lfWeight = <span class="number">2</span>;                <span class="comment">//设置字体线条的宽度</span></span><br><span class="line">  lf.lfItalic = italic;           <span class="comment">//斜体</span></span><br><span class="line">  lf.lfUnderline = underline;     <span class="comment">//下划线</span></span><br><span class="line">  lf.lfStrikeOut = <span class="number">0</span>;             <span class="comment">//是否字符中央加横线</span></span><br><span class="line">  lf.lfCharSet = DEFAULT_CHARSET; <span class="comment">//字符集</span></span><br><span class="line">  lf.lfOutPrecision = <span class="number">0</span>;          <span class="comment">//字体的精确度</span></span><br><span class="line">  lf.lfQuality = PROOF_QUALITY;   <span class="comment">//字体质量</span></span><br><span class="line">  lf.lfPitchAndFamily = <span class="number">0</span>;        <span class="comment">//选择字体的间距和字体家族</span></span><br><span class="line">  <span class="built_in">strcpy_s</span>(lf.lfFaceName, fn);    <span class="comment">//字体的名称</span></span><br><span class="line"></span><br><span class="line">  HFONT hf = <span class="built_in">CreateFontIndirectA</span>(&amp;lf);</span><br><span class="line">  HDC hdc = <span class="built_in">CreateCompatibleDC</span>(<span class="number">0</span>);</span><br><span class="line">  HFONT holdfont = (HFONT)<span class="built_in">SelectObject</span>(hdc, hf);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">int</span> strBaseW = <span class="number">0</span>, strBaseH = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">int</span> singleRow = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">char</span> buf[<span class="number">1</span> &lt;&lt; <span class="number">12</span>];</span><br><span class="line">  <span class="built_in">strcpy_s</span>(buf, str);</span><br><span class="line">  <span class="keyword">char</span> *bufT[<span class="number">1</span> &lt;&lt; <span class="number">12</span>]; <span class="comment">//这个用于分隔字符串后剩余的字符，可能会超出。</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//处理多行</span></span><br><span class="line">  {</span><br><span class="line">    <span class="keyword">int</span> nnh = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> cw, ch;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *ln = <span class="built_in">strtok_s</span>(buf, <span class="string">"\n"</span>, bufT);</span><br><span class="line">    <span class="keyword">while</span> (ln != <span class="number">0</span>) {</span><br><span class="line">      <span class="built_in">GetStringSize</span>(hdc, ln, &amp;cw, &amp;ch);</span><br><span class="line">      strBaseW = <span class="built_in">max</span>(strBaseW, cw);</span><br><span class="line">      strBaseH = <span class="built_in">max</span>(strBaseH, ch);</span><br><span class="line"></span><br><span class="line">      ln = <span class="built_in">strtok_s</span>(<span class="number">0</span>, <span class="string">"\n"</span>, bufT);</span><br><span class="line">      nnh++;</span><br><span class="line">    }</span><br><span class="line">    singleRow = strBaseH;</span><br><span class="line">    strBaseH *= nnh;</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (org.x + strBaseW &lt; <span class="number">0</span> || org.y + strBaseH &lt; <span class="number">0</span>) {</span><br><span class="line">    <span class="built_in">SelectObject</span>(hdc, holdfont);</span><br><span class="line">    <span class="built_in">DeleteObject</span>(hf);</span><br><span class="line">    <span class="built_in">DeleteObject</span>(hdc);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  r = org.x + strBaseW &gt; dst.cols ? dst.cols - org.x - <span class="number">1</span> : strBaseW - <span class="number">1</span>;</span><br><span class="line">  b = org.y + strBaseH &gt; dst.rows ? dst.rows - org.y - <span class="number">1</span> : strBaseH - <span class="number">1</span>;</span><br><span class="line">  org.x = org.x &lt; <span class="number">0</span> ? <span class="number">0</span> : org.x;</span><br><span class="line">  org.y = org.y &lt; <span class="number">0</span> ? <span class="number">0</span> : org.y;</span><br><span class="line"></span><br><span class="line">  BITMAPINFO bmp = {<span class="number">0</span>};</span><br><span class="line">  BITMAPINFOHEADER &amp;bih = bmp.bmiHeader;</span><br><span class="line">  <span class="keyword">int</span> strDrawLineStep = strBaseW * <span class="number">3</span> % <span class="number">4</span> == <span class="number">0</span></span><br><span class="line">                            ? strBaseW * <span class="number">3</span></span><br><span class="line">                            : (strBaseW * <span class="number">3</span> + <span class="number">4</span> - ((strBaseW * <span class="number">3</span>) % <span class="number">4</span>));</span><br><span class="line"></span><br><span class="line">  bih.biSize = <span class="built_in"><span class="keyword">sizeof</span></span>(BITMAPINFOHEADER);</span><br><span class="line">  bih.biWidth = strBaseW;</span><br><span class="line">  bih.biHeight = strBaseH;</span><br><span class="line">  bih.biPlanes = <span class="number">1</span>;</span><br><span class="line">  bih.biBitCount = <span class="number">24</span>;</span><br><span class="line">  bih.biCompression = BI_RGB;</span><br><span class="line">  bih.biSizeImage = strBaseH * strDrawLineStep;</span><br><span class="line">  bih.biClrUsed = <span class="number">0</span>;</span><br><span class="line">  bih.biClrImportant = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">void</span> *pDibData = <span class="number">0</span>;</span><br><span class="line">  HBITMAP hBmp = <span class="built_in">CreateDIBSection</span>(hdc, &amp;bmp, DIB_RGB_COLORS, &amp;pDibData, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">CV_Assert</span>(pDibData != <span class="number">0</span>);</span><br><span class="line">  HBITMAP hOldBmp = (HBITMAP)<span class="built_in">SelectObject</span>(hdc, hBmp);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// color.val[2], color.val[1], color.val[0]</span></span><br><span class="line">  <span class="built_in">SetTextColor</span>(hdc, <span class="built_in">RGB</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>));</span><br><span class="line">  <span class="built_in">SetBkColor</span>(hdc, <span class="number">0</span>);</span><br><span class="line">  <span class="comment">// SetStretchBltMode(hDC, COLORONCOLOR);</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">strcpy_s</span>(buf, str);</span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">char</span> *ln = <span class="built_in">strtok_s</span>(buf, <span class="string">"\n"</span>, bufT);</span><br><span class="line">  <span class="keyword">int</span> outTextY = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> (ln != <span class="number">0</span>) {</span><br><span class="line">    <span class="built_in">TextOutA</span>(hdc, <span class="number">0</span>, outTextY, ln, <span class="built_in">strlen</span>(ln));</span><br><span class="line">    outTextY += singleRow;</span><br><span class="line">    ln = <span class="built_in">strtok_s</span>(<span class="number">0</span>, <span class="string">"\n"</span>, bufT);</span><br><span class="line">  }</span><br><span class="line">  uchar *dstData = (uchar *)dst.data;</span><br><span class="line">  <span class="keyword">int</span> dstStep = dst.step / <span class="built_in"><span class="keyword">sizeof</span></span>(dstData[<span class="number">0</span>]);</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">char</span> *pImg =</span><br><span class="line">      (<span class="keyword">unsigned</span> <span class="keyword">char</span> *)dst.data + org.x * dst.<span class="built_in">channels</span>() + org.y * dstStep;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">char</span> *pStr = (<span class="keyword">unsigned</span> <span class="keyword">char</span> *)pDibData + x * <span class="number">3</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> tty = y; tty &lt;= b; ++tty) {</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> *subImg = pImg + (tty - y) * dstStep;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> *subStr = pStr + (strBaseH - tty - <span class="number">1</span>) * strDrawLineStep;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> ttx = x; ttx &lt;= r; ++ttx) {</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> n = <span class="number">0</span>; n &lt; dst.<span class="built_in">channels</span>(); ++n) {</span><br><span class="line">        <span class="keyword">double</span> vtxt = subStr[n] / <span class="number">255.0</span>;</span><br><span class="line">        <span class="keyword">int</span> cvv = vtxt * color.val[n] + (<span class="number">1</span> - vtxt) * subImg[n];</span><br><span class="line">        subImg[n] = cvv &gt; <span class="number">255</span> ? <span class="number">255</span> : (cvv &lt; <span class="number">0</span> ? <span class="number">0</span> : cvv);</span><br><span class="line">      }</span><br><span class="line"></span><br><span class="line">      subStr += <span class="number">3</span>;</span><br><span class="line">      subImg += dst.<span class="built_in">channels</span>();</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="built_in">SelectObject</span>(hdc, hOldBmp);</span><br><span class="line">  <span class="built_in">SelectObject</span>(hdc, holdfont);</span><br><span class="line">  <span class="built_in">DeleteObject</span>(hf);</span><br><span class="line">  <span class="built_in">DeleteObject</span>(hBmp);</span><br><span class="line">  <span class="built_in">DeleteDC</span>(hdc);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h4 id="调用"><a href="#调用" class="headerlink" title="调用"></a>调用</h4><figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Mat imText;</span><br><span class="line"><span class="keyword">if</span> (m_colorMap) {</span><br><span class="line">  imText = <span class="built_in">Mat</span>(text_size, CV_8UC3, <span class="built_in">Scalar</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>));</span><br><span class="line">} <span class="keyword">else</span> <span class="keyword">if</span> (m_colorMap == <span class="number">0</span>) {</span><br><span class="line">  imText = <span class="built_in">Mat</span>(text_size, CV_8UC1, <span class="built_in">Scalar</span>(<span class="number">255</span>));</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">origin.x = <span class="number">0</span>;</span><br><span class="line">origin.y = text_size.height - <span class="number">6</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">char</span> *p = (<span class="keyword">char</span> *)text.<span class="built_in">data</span>();</span><br><span class="line"><span class="built_in">putTextZH</span>(imText, p, <span class="built_in">Point</span>(origin.x + <span class="number">20</span>, <span class="number">4</span>), <span class="built_in">Scalar</span>(<span class="number">120</span>, <span class="number">120</span>, <span class="number">120</span>), <span class="number">22</span>,</span><br><span class="line">          <span class="string">"微软雅黑"</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br></pre></td></tr></tbody></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://qianxunslimg.github.io/2021/09/01/vector-clear-fang-fa-nei-cun-shi-fang-wen-ti/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="qianxunslimg">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="qianxunslimgのblog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/09/01/vector-clear-fang-fa-nei-cun-shi-fang-wen-ti/" class="post-title-link" itemprop="url">vector clear() 方法 内存释放问题</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-09-01 19:32:31" itemprop="dateCreated datePublished" datetime="2021-09-01T19:32:31+08:00">2021-09-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-04-23 00:29:44" itemprop="dateModified" datetime="2022-04-23T00:29:44+08:00">2022-04-23</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <div class="com-markdown-collpase-main">
<div class="rno-markdown J-articleContent">
<pre class="prism-token token  language-javascript">自己查到的三处说法的对比：</pre>
<pre class="prism-token token  language-javascript">一、转自知道的答案：https<span class="token operator">:<span class="token operator">/<span class="token operator">/zhidao<span class="token punctuation">.baidu<span class="token punctuation">.com<span class="token operator">/question<span class="token operator">/<span class="token number">323662520.html<span class="token operator">?qq<span class="token operator">-pf<span class="token operator">-to<span class="token operator">=pcqq<span class="token punctuation">.c2c#</span></span></span></span></span></span></span></span></span></span></span></span></span></pre>
<pre class="prism-token token  language-javascript"><span class="token function">vector，clear<span class="token punctuation">(<span class="token punctuation">)<span class="token function">并不真正释放内存<span class="token punctuation">(这是为优化效率所做的事<span class="token punctuation">)<span class="token function">，clear实际所做的是为vector中所保存的所有对象调用析构函数<span class="token punctuation">(如果有的话<span class="token punctuation">)<span class="token punctuation">,然后初始化size这些东西，让觉得把所有的对象清除了。
　　真正释放内存是在vector的析构函数里进行的，所以一旦超出vector的作用域（如函数返回<span class="token punctuation">)，首先它所保存的所有对象会被析构，然后会调用allocator中的deallocate函数回收对象本身的内存。
　　所以，某些编译器clear后还能访问到对象数据（因为它根本没清除），在一些比较新的<span class="token constant">C<span class="token operator">++<span class="token function">编译器上<span class="token punctuation">(例如<span class="token constant">VS2008<span class="token punctuation">)<span class="token function">，当进行数组引用时<span class="token punctuation">(例如a<span class="token punctuation">[<span class="token number">2<span class="token punctuation">]这种用法<span class="token punctuation">)<span class="token punctuation">,<span class="token constant">STL库中会有一些check函数根据当前容器的size值来判断下标引用是否超出范围，如果超出，则会执行这样一句：
　　<span class="token function">_THROW<span class="token punctuation">(out_of_range<span class="token punctuation">, <span class="token string">"invalid vector&lt;T&gt; subscript"<span class="token punctuation">)<span class="token punctuation">;
　　即抛出一个越界异常，clear后没有捕获异常，程序在新编译器编译后就会崩溃掉。</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></pre>
<pre class="prism-token token  language-javascript"><span class="token operator">--<span class="token operator">--<span class="token operator">--<span class="token operator">--<span class="token operator">--<span class="token operator">--<span class="token operator">--<span class="token operator">--<span class="token operator">--<span class="token operator">--<span class="token operator">--<span class="token operator">--<span class="token operator">-分割线<span class="token operator">--<span class="token operator">--<span class="token operator">--<span class="token operator">--<span class="token operator">--<span class="token operator">--<span class="token operator">--<span class="token operator">--<span class="token operator">--<span class="token operator">--<span class="token operator">--<span class="token operator">--<span class="token operator">--<span class="token operator">--<span class="token operator">--<span class="token operator">--<span class="token operator">--<span class="token operator">--<span class="token operator">--<span class="token operator">--<span class="token operator">--<span class="token operator">--<span class="token operator">--<span class="token operator">--<span class="token operator">--<span class="token operator">--<span class="token operator">--<span class="token operator">--<span class="token operator">--<span class="token operator">--<span class="token operator">--</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></pre>


<p>二、转自博客：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/summerRQ/articles/2407974.html">https://www.cnblogs.com/summerRQ/articles/2407974.html</a></p>
<p>vector ： C++ STL中的顺序容器，封装数组</p>
<ol>
<li>vector容器的内存自增长&amp;nbsp;</li>
</ol>
<p>与其他容器不同，其内存空间只会增长，不会减小。先来看看”C++ Primer”中怎么说：为了支持快速的随机访问，vector容器的元素以连续方式存放，每一个元素都紧挨着前一个元素存储。设想一下，当vector添加一个元素时，为了满足连续存放这个特性，都需要重新分配空间、拷贝元素、撤销旧空间，这样性能难以接受。因此STL实现者在对vector进行内存分配时，其实际分配的容量要比当前所需的空间多一些。就是说，vector容器预留了一些额外的存储区，用于存放新添加的元素，这样就不必为每个新元素重新分配整个容器的内存空间。</p>
<p>关于vector的内存空间，有两个函数需要注意：size()成员指当前拥有的元素个数；capacity()成员指当前(容器必须分配新存储空间之前)可以存储的元素个数。reserve()成员可以用来控制容器的预留空间。vector另外一个特性在于它的内存空间会自增长，每当vector容器不得不分配新的存储空间时，会以加倍当前容量的分配策略实现重新分配。例如，当前capacity为50，当添加第51个元素时，预留空间不够用了，vector容器会重新分配大小为100的内存空间，作为新连续存储的位置。</p>
<p>2.&amp;nbsp;vector内存释放</p>
<p>由于vector的内存占用空间只增不减，比如你首先分配了10,000个字节，然后erase掉后面9,999个，留下一个有效元素，但是内存占用仍为10,000个。所有内存空间是在vector析构时候才能被系统回收。empty()用来检测容器是否为空的，clear()可以清空所有元素。但是即使clear()，vector所占用的内存空间依然如故，无法保证内存的回收。</p>
<p>如果需要空间动态缩小，可以考虑使用deque。如果非vector不可，可以用swap()来帮助你释放内存。具体方法如下：</p>
<pre class="prism-token token  language-javascript">vector<span class="token operator">&lt;int<span class="token operator">&gt; nums<span class="token punctuation">; 
nums<span class="token punctuation">.<span class="token function">push_back<span class="token punctuation">(<span class="token number">1<span class="token punctuation">)<span class="token punctuation">;
nums<span class="token punctuation">.<span class="token function">push_back<span class="token punctuation">(<span class="token number">1<span class="token punctuation">)<span class="token punctuation">;
nums<span class="token punctuation">.<span class="token function">push_back<span class="token punctuation">(<span class="token number">2<span class="token punctuation">)<span class="token punctuation">;
nums<span class="token punctuation">.<span class="token function">push_back<span class="token punctuation">(<span class="token number">2<span class="token punctuation">)<span class="token punctuation">; 
vector<span class="token operator">&lt;int<span class="token operator">&gt;<span class="token punctuation">(<span class="token punctuation">)<span class="token punctuation">.<span class="token function">swap<span class="token punctuation">(nums<span class="token punctuation">)<span class="token punctuation">; <span class="token comment">//或者nums.swap(vector&lt;int&gt; ())</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></pre>


<p>或者如下所示，使用一对大括号，意思一样的：</p>
<pre class="prism-token token  language-javascript"><span class="token comment">//加一对大括号是可以让tmp退出{}的时候自动析构
<span class="token punctuation">{ 
    std<span class="token operator">:<span class="token operator">:vector<span class="token operator">&lt;int<span class="token operator">&gt; tmp <span class="token operator">=   nums<span class="token punctuation">;  
    nums<span class="token punctuation">.<span class="token function">swap<span class="token punctuation">(tmp<span class="token punctuation">)<span class="token punctuation">; 
<span class="token punctuation">}</span></span></span></span></span></span></span></span></span></span></span></span></span></span></pre>


<p>&amp;nbsp;swap()是交换函数，使vector离开其自身的作用域，从而强制释放vector所占的内存空间，总而言之，释放vector内存最简单的方法是vector&lt;int&gt;.swap(nums)。当时如果nums是一个类的成员，不能把vector&lt;int&gt;.swap(nums)写进类的析构函数中，否则会导致double free or corruption (fasttop)的错误，原因可能是重复释放内存。标准解决方法如下：</p>
<pre class="prism-token token  language-javascript">template <span class="token operator">&lt; <span class="token keyword">class <span class="token class-name">T <span class="token operator">&gt;
<span class="token keyword">void <span class="token function">ClearVector<span class="token punctuation">( <span class="token parameter">vector<span class="token operator">&lt; <span class="token constant">T <span class="token operator">&gt;<span class="token operator">&amp; vt <span class="token punctuation">) 
<span class="token punctuation">{
    vector<span class="token operator">&lt; <span class="token constant">T <span class="token operator">&gt; vtTemp<span class="token punctuation">; 
    veTemp<span class="token punctuation">.<span class="token function">swap<span class="token punctuation">( vt <span class="token punctuation">)<span class="token punctuation">;
<span class="token punctuation">}</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></pre>


<ol start="3">
<li>利用vector释放指针</li>
</ol>
<p>如果vector中存放的是指针，那么当vector销毁时，这些指针指向的对象不会被销毁，那么内存就不会被释放。如下面这种情况，vector中的元素时由new操作动态申请出来的对象指针：</p>
<pre class="prism-token token  language-javascript">#include <span class="token operator">&lt;vector<span class="token operator">&gt; 
using namespace std<span class="token punctuation">; 
vector<span class="token operator">&lt;<span class="token keyword">void <span class="token operator">*<span class="token operator">&gt; v<span class="token punctuation">;</span></span></span></span></span></span></span></span></pre>


<p>每次new之后调用v.push_back()该指针，在程序退出或者根据需要，用以下代码进行内存的释放：&amp;nbsp;</p>
<pre class="prism-token token  language-javascript"><span class="token keyword">for <span class="token punctuation">(vector<span class="token operator">&lt;<span class="token keyword">void <span class="token operator">*<span class="token operator">&gt;<span class="token operator">:<span class="token operator">:iterator it <span class="token operator">= v<span class="token punctuation">.<span class="token function">begin<span class="token punctuation">(<span class="token punctuation">)<span class="token punctuation">; it <span class="token operator">!= v<span class="token punctuation">.<span class="token function">end<span class="token punctuation">(<span class="token punctuation">)<span class="token punctuation">; it <span class="token operator">++<span class="token punctuation">) 
    <span class="token keyword">if <span class="token punctuation">(<span class="token constant">NULL <span class="token operator">!= <span class="token operator">*it<span class="token punctuation">) 
    <span class="token punctuation">{
        <span class="token keyword">delete <span class="token operator">*it<span class="token punctuation">; 
        <span class="token operator">*it <span class="token operator">= <span class="token constant">NULL<span class="token punctuation">;
    <span class="token punctuation">}
v<span class="token punctuation">.<span class="token function">clear<span class="token punctuation">(<span class="token punctuation">)<span class="token punctuation">;</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></pre>


<p>三、转自博客：<a target="_blank" rel="noopener" href="https://blog.csdn.net/hk_john/article/details/72463318">https://blog.csdn.net/hk_john/article/details/72463318</a></p>
<p>最近经常用到vector容器，发现它的clear（）函数有点意思，经过验证之后进行一下总结。</p>
<p>clear（）函数的调用方式是，vector&lt;datatype&gt; temp（50）;//定义了50个datatype大小的空间。temp.clear();</p>
<p>作用：将会清空temp中的所有元素，包括temp开辟的空间（size），但是capacity会保留，即不可以以temp[1]这种形式赋初值，只能通过temp.push_back(value)的形式赋初值。</p>
<p>同样对于vector&lt;vector&lt;datatype&gt; &gt; temp1（50）这种类型的变量，使用temp1.clear()之后将会不能用temp1[1].push_back(value)进行赋初值，只能使用temp1.push_back(temp)；的形式。</p>
<p>下面的代码是可以运行的。</p>
<pre class="prism-token token  language-javascript"></pre>

<ol>
<li>#include &lt;iostream&gt;</li>
<li>#include&lt;vector&gt;<br>3.4.  using namespace std;<br>5.6.  int main(){<br>7.8.  vector&lt;vector&lt;int&gt;&gt; test(50);</li>
<li>vector&lt;int&gt; temp;</li>
<li>test[10].push_back(1);</li>
<li>cout&lt;&lt;test[10][0]&lt;&lt;endl;</li>
<li>test.clear();<br>13.14.15.  for(int i=0;i&lt;51;i++)</li>
<li>test.push_back(temp);<br>17.18.  system(“pause”);</li>
<li>return 0;</li>
<li>}</li>
</ol>
<p>但是这样是会越界错误的。</p>
<pre class="prism-token token  language-javascript"></pre>

<ol>
<li>#include &lt;iostream&gt;</li>
<li>#include&lt;vector&gt;<br>3.4.  using namespace std;<br>5.6.  int main(){<br>7.8.  vector&lt;vector&lt;int&gt;&gt; test(50);</li>
<li>vector&lt;int&gt; temp;</li>
<li>test[10].push_back(1);</li>
<li>cout&lt;&lt;test[10][0]&lt;&lt;endl;</li>
<li>test.clear();<br>13.14.  for(int i=0;i&lt;50;i++)</li>
<li>test[i].push_back(1);<br>16.17.  system(“pause”);</li>
<li>return 0;</li>
<li>}</li>
</ol>
<p>并且即使我们使用</p>
<pre class="prism-token token  language-javascript"></pre>

<ol>
<li>for(int i=0;i&lt;100;i++)</li>
<li>test[i].push_back(1);</li>
</ol>
<p>都是可以的，因为size已经被清除了。</p>
</div></div>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://qianxunslimg.github.io/2021/08/26/bmp-de-bao-cun/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="qianxunslimg">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="qianxunslimgのblog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/08/26/bmp-de-bao-cun/" class="post-title-link" itemprop="url">BMP的保存</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-08-26 19:28:00" itemprop="dateCreated datePublished" datetime="2021-08-26T19:28:00+08:00">2021-08-26</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-04-24 17:00:44" itemprop="dateModified" datetime="2022-04-24T17:00:44+08:00">2022-04-24</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h4><ol>
<li>做一个实际工程应用的项目 甲方是将图片拖到cad里进行观看 因此就要求比例尺等的信息保存 cad支持的只有tif和bmp，而我的软件的成图是基于opencv的 opencv的imwrite还是过于粗糙，因此查阅整理了一个完整bmp的函数</li>
<li>bmp的头信息是很复杂的，并不是单纯的改个文件名就可以，这也是为什么 mfc的icon那么难搞 网上找遍格式转换的网站 只有那么一两个的转换结果可以使用（简直折磨）</li>
<li>bmp格式这里不加赘述了 可以惨开<a target="_blank" rel="noopener" href="https://blog.csdn.net/u012877472/article/details/50272771">这个</a></li>
</ol>
<h4 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h4><p>bmp.h</p>
<figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> BMP_H</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> BMP_H</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">unsigned</span> <span class="keyword">char</span> LBYTE;  <span class="comment">//</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">unsigned</span> <span class="keyword">short</span> LWORD; <span class="comment">//</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">unsigned</span> <span class="keyword">int</span> LDWORD;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> LLONG; <span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> pack(2)</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> {</span></span><br><span class="line">  LWORD bfType;</span><br><span class="line">  LDWORD bfSize;</span><br><span class="line">  LWORD bfReserved1;</span><br><span class="line">  LWORD bfReserved2;</span><br><span class="line">  LDWORD bfOffBits;</span><br><span class="line">} LBITMAPFILEHEADER;</span><br><span class="line"><span class="comment">// #pragma pack(pop)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> {</span></span><br><span class="line">  LDWORD biSize;</span><br><span class="line">  LLONG biWidth;</span><br><span class="line">  LLONG biHeight;</span><br><span class="line">  LWORD biPlanes;</span><br><span class="line">  LWORD biBitCount;</span><br><span class="line">  LDWORD biCompression;</span><br><span class="line">  LDWORD biSizeImage;</span><br><span class="line">  LLONG biXPelsPerMeter;</span><br><span class="line">  LLONG biYPelsPerMeter;</span><br><span class="line">  LDWORD biClrUsed;</span><br><span class="line">  LDWORD biClrImportant;</span><br><span class="line">} LBITMAPINFOHEADER;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> {</span></span><br><span class="line">  LBYTE rgbBlue;</span><br><span class="line">  LBYTE rgbGreen;</span><br><span class="line">  LBYTE rgbRed;</span><br><span class="line">  LBYTE rgbReserved;</span><br><span class="line">} LRGBQUAD;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> {</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">char</span> *buf;</span><br><span class="line">  <span class="keyword">int</span> width_x;</span><br><span class="line">  <span class="keyword">int</span> height_y;</span><br><span class="line">  <span class="keyword">int</span> deepth;</span><br><span class="line">  LRGBQUAD *palette;</span><br><span class="line">} LBmpbase;</span><br><span class="line"></span><br><span class="line"><span class="comment">// bool saveBmp(char*, unsigned char*, int, int, int, RGBQUAD*);</span></span><br><span class="line"><span class="comment">// Bmpbase readbmp(char*);</span></span><br><span class="line"><span class="comment">/*bool saveBmp(char *, unsigned char *, int, int, int, LRGBQUAD *);*/</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">SaveBmp</span><span class="params">(<span class="keyword">char</span> *fileName, <span class="keyword">unsigned</span> <span class="keyword">char</span> *imgBuffer, <span class="keyword">int</span> imWidth,</span></span></span><br><span class="line"><span class="params"><span class="function">             <span class="keyword">int</span> imHeight, <span class="keyword">int</span> x_scale, <span class="keyword">int</span> y_scale, <span class="keyword">int</span> m_colorTable)</span></span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>bmp.cpp</p>
<p>参数说明，其他参数没有什么好说明的 从英文可以看出来 以此是文件名，图像的data, 宽 高 宽比例尺 高比例尺 </p>
<p>最后一个参数是灰度彩色的标志位 <code>0表示灰度图 </code> 非0为彩色</p>
<figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"stdafx.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"bmp.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">SaveBmp</span><span class="params">(<span class="keyword">char</span> *fileName, <span class="keyword">unsigned</span> <span class="keyword">char</span> *imgBuffer, <span class="keyword">int</span> imWidth,</span></span></span><br><span class="line"><span class="params"><span class="function">             <span class="keyword">int</span> imHeight, <span class="keyword">int</span> x_scale, <span class="keyword">int</span> y_scale, <span class="keyword">int</span> m_colorTable)</span> </span>{</span><br><span class="line">  <span class="keyword">if</span> (!imgBuffer) {</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">int</span> biBitCount;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (m_colorTable) {</span><br><span class="line">    biBitCount = <span class="number">24</span>;</span><br><span class="line">  } <span class="keyword">else</span> <span class="keyword">if</span> (m_colorTable == <span class="number">0</span>) {</span><br><span class="line">    biBitCount = <span class="number">8</span>;</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">int</span> colorTablesize;</span><br><span class="line">  <span class="keyword">if</span> (m_colorTable) {</span><br><span class="line">    colorTablesize = <span class="number">0</span>;</span><br><span class="line">  } <span class="keyword">else</span> <span class="keyword">if</span> (m_colorTable == <span class="number">0</span>) {</span><br><span class="line">    colorTablesize = <span class="number">1024</span>;</span><br><span class="line">  }</span><br><span class="line">  <span class="comment">//颜色表大小，以字节为单位，灰度图颜色表大小1024，彩色图为0</span></span><br><span class="line">  <span class="keyword">int</span> lineByte = (imWidth * biBitCount / <span class="number">8</span> + <span class="number">3</span>) / <span class="number">4</span> * <span class="number">4</span>;</span><br><span class="line">  FILE *fp = <span class="built_in">fopen</span>(fileName, <span class="string">"wb"</span>);</span><br><span class="line">  <span class="keyword">if</span> (!fp) {</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  }</span><br><span class="line">  LBITMAPFILEHEADER filehead;</span><br><span class="line">  filehead.bfType = <span class="number">0x4D42</span>;</span><br><span class="line">  filehead.bfSize = <span class="built_in"><span class="keyword">sizeof</span></span>(LBITMAPFILEHEADER) + <span class="built_in"><span class="keyword">sizeof</span></span>(LBITMAPINFOHEADER) +</span><br><span class="line">                    colorTablesize + lineByte * imHeight;</span><br><span class="line">  filehead.bfReserved1 = <span class="number">0</span>;</span><br><span class="line">  filehead.bfReserved2 = <span class="number">0</span>;</span><br><span class="line">  filehead.bfOffBits = <span class="number">54</span> + colorTablesize;</span><br><span class="line">  <span class="comment">//写位图文件头进文件</span></span><br><span class="line">  <span class="built_in">fwrite</span>(&amp;filehead, <span class="built_in"><span class="keyword">sizeof</span></span>(LBITMAPFILEHEADER), <span class="number">1</span>, fp);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//申请位图文件信息头结构变量， 填写文件信息头信息</span></span><br><span class="line">  LBITMAPINFOHEADER infoHead;</span><br><span class="line">  infoHead.biBitCount = biBitCount;</span><br><span class="line">  infoHead.biClrImportant = <span class="number">0</span>;</span><br><span class="line">  infoHead.biClrUsed = <span class="number">0</span>;</span><br><span class="line">  infoHead.biSize = <span class="number">40</span>;</span><br><span class="line">  infoHead.biWidth = imWidth;</span><br><span class="line">  infoHead.biHeight = imHeight;</span><br><span class="line">  infoHead.biPlanes = <span class="number">1</span>;</span><br><span class="line">  infoHead.biCompression = BI_RGB;</span><br><span class="line">  infoHead.biSizeImage = lineByte * imHeight;</span><br><span class="line">  infoHead.biXPelsPerMeter = x_scale;</span><br><span class="line">  infoHead.biYPelsPerMeter = y_scale;</span><br><span class="line">  <span class="built_in">fwrite</span>(&amp;infoHead, <span class="built_in"><span class="keyword">sizeof</span></span>(LBITMAPINFOHEADER), <span class="number">1</span>, fp);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (m_colorTable == <span class="number">0</span>) {</span><br><span class="line">    LRGBQUAD *pColorTable = <span class="keyword">new</span> LRGBQUAD[<span class="number">256</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">256</span>; i++) {</span><br><span class="line">      pColorTable[i].rgbBlue = i;</span><br><span class="line">      pColorTable[i].rgbGreen = i;</span><br><span class="line">      pColorTable[i].rgbRed = i;</span><br><span class="line">      pColorTable[i].rgbReserved = <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="built_in">fwrite</span>(pColorTable, <span class="built_in"><span class="keyword">sizeof</span></span>(LRGBQUAD), <span class="number">256</span>, fp); <span class="comment">//彩色图 无需写入颜色表</span></span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="comment">//写位图数据进文件</span></span><br><span class="line">  <span class="built_in">fwrite</span>(imgBuffer, imHeight * lineByte, <span class="number">1</span>, fp);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">fclose</span>(fp);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h4 id="调用"><a href="#调用" class="headerlink" title="调用"></a>调用</h4><p>其实还有一个注意的点就是 <code>bmp还涉及到一个反转的问题</code> 从opencv的mat格式 存储为bmp是需要对mat进行一下<code>反转</code></p>
<p>我的调用图下</p>
<figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Mat res;</span><br><span class="line"><span class="built_in">flip</span>(img, res, <span class="number">0</span>); <span class="comment">// bmp需要垂直反转</span></span><br><span class="line"></span><br><span class="line">CString strID;</span><br><span class="line">strID.<span class="built_in">Format</span>(<span class="string">"_%ld.bmp"</span>, m_conTab.<span class="built_in">GetCurSel</span>() + <span class="number">1</span>);</span><br><span class="line">strFileName.<span class="built_in">Replace</span>(<span class="string">".bmp"</span>, strID);</span><br><span class="line"><span class="keyword">if</span> (i == <span class="number">0</span> || i == <span class="number">2</span>) {</span><br><span class="line">  <span class="comment">//深度图按设定的比例尺保存</span></span><br><span class="line">  <span class="built_in">SaveBmp</span>((LPSTR)(LPCTSTR)strFileName, res.data, m_pView-&gt;m_dwWidth,</span><br><span class="line">          m_pView-&gt;m_dwHeight,</span><br><span class="line">          <span class="built_in">round</span>((<span class="keyword">double</span>)<span class="number">1000</span> * m_xactualScale / m_nHScales[i]),</span><br><span class="line">          <span class="built_in">round</span>((<span class="keyword">double</span>)<span class="number">1000</span> * m_yactualScale / m_nVScales[i]), m_colorMap);</span><br><span class="line">} <span class="keyword">else</span> {</span><br><span class="line">  <span class="comment">//频率和hv图片等比保存</span></span><br><span class="line">  <span class="built_in">SaveBmp</span>((LPSTR)(LPCTSTR)strFileName, res.data, m_pView-&gt;m_dwWidth,</span><br><span class="line">          m_pView-&gt;m_dwHeight,</span><br><span class="line">          <span class="built_in">round</span>((<span class="keyword">double</span>)<span class="number">1000</span> * m_xactualScale / m_nHScales[i]),</span><br><span class="line">          <span class="built_in">round</span>((<span class="keyword">double</span>)<span class="number">1000</span> * m_xactualScale / m_nHScales[i]), m_colorMap);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://qianxunslimg.github.io/2021/07/26/qt-yang-shi-biao-dao-ru/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="qianxunslimg">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="qianxunslimgのblog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/07/26/qt-yang-shi-biao-dao-ru/" class="post-title-link" itemprop="url">Qt样式表导入</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-07-26 19:28:00" itemprop="dateCreated datePublished" datetime="2021-07-26T19:28:00+08:00">2021-07-26</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-04-24 16:27:00" itemprop="dateModified" datetime="2022-04-24T16:27:00+08:00">2022-04-24</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"select.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QtWidgets/QApplication&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span> </span>{</span><br><span class="line">  <span class="function">QApplication <span class="title">a</span><span class="params">(argc, argv)</span></span>;</span><br><span class="line">  select1 w;</span><br><span class="line"></span><br><span class="line">  <span class="function">QFile <span class="title">qssFile</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">      <span class="string">"D://qq received//select//select//lightblue.css"</span>)</span></span>; <span class="comment">//资源文件":/css.qss"</span></span><br><span class="line">  qssFile.<span class="built_in">open</span>(QFile::ReadOnly);</span><br><span class="line">  <span class="keyword">if</span> (qssFile.<span class="built_in">isOpen</span>()) {</span><br><span class="line">    QString qss = <span class="built_in">QLatin1String</span>(qssFile.<span class="built_in">readAll</span>()); <span class="comment">//读取</span></span><br><span class="line">    qApp-&gt;<span class="built_in">setStyleSheet</span>(qss);                       <span class="comment">//设置</span></span><br><span class="line">    qssFile.<span class="built_in">close</span>();</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  w.<span class="built_in">show</span>();</span><br><span class="line">  <span class="keyword">return</span> a.<span class="built_in">exec</span>();</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>另外 qt有一个样式表生成的小工具 quicreator 可以自行查找</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://qianxunslimg.github.io/2021/04/20/chuan-kou-fa-song-wen-ti/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="qianxunslimg">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="qianxunslimgのblog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/04/20/chuan-kou-fa-song-wen-ti/" class="post-title-link" itemprop="url">串口发送问题</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-04-20 19:42:17" itemprop="dateCreated datePublished" datetime="2021-04-20T19:42:17+08:00">2021-04-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-04-23 00:31:21" itemprop="dateModified" datetime="2022-04-23T00:31:21+08:00">2022-04-23</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>串口发送hex命令为char型的十六进制命令，并用到了CRC16校验，分别取校验结果数据的高低位</p>
<p>10进制int型数据转16进制，并取高低位：</p>
<figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> TABLE_METHOD    1</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">uint8_t</span> CRCHi[] = {</span><br><span class="line">    <span class="number">0x00</span>, <span class="number">0xC1</span>, <span class="number">0x81</span>, <span class="number">0x40</span>, <span class="number">0x01</span>, <span class="number">0xC0</span>, <span class="number">0x80</span>, <span class="number">0x41</span>, <span class="number">0x01</span>, <span class="number">0xC0</span>, <span class="number">0x80</span>, <span class="number">0x41</span>,</span><br><span class="line">    <span class="number">0x00</span>, <span class="number">0xC1</span>, <span class="number">0x81</span>, <span class="number">0x40</span>, <span class="number">0x01</span>, <span class="number">0xC0</span>, <span class="number">0x80</span>, <span class="number">0x41</span>, <span class="number">0x00</span>, <span class="number">0xC1</span>, <span class="number">0x81</span>, <span class="number">0x40</span>,</span><br><span class="line">    <span class="number">0x00</span>, <span class="number">0xC1</span>, <span class="number">0x81</span>, <span class="number">0x40</span>, <span class="number">0x01</span>, <span class="number">0xC0</span>, <span class="number">0x80</span>, <span class="number">0x41</span>, <span class="number">0x01</span>, <span class="number">0xC0</span>, <span class="number">0x80</span>, <span class="number">0x41</span>,</span><br><span class="line">    <span class="number">0x00</span>, <span class="number">0xC1</span>, <span class="number">0x81</span>, <span class="number">0x40</span>, <span class="number">0x00</span>, <span class="number">0xC1</span>, <span class="number">0x81</span>, <span class="number">0x40</span>, <span class="number">0x01</span>, <span class="number">0xC0</span>, <span class="number">0x80</span>, <span class="number">0x41</span>,</span><br><span class="line">    <span class="number">0x00</span>, <span class="number">0xC1</span>, <span class="number">0x81</span>, <span class="number">0x40</span>, <span class="number">0x01</span>, <span class="number">0xC0</span>, <span class="number">0x80</span>, <span class="number">0x41</span>, <span class="number">0x01</span>, <span class="number">0xC0</span>, <span class="number">0x80</span>, <span class="number">0x41</span>,</span><br><span class="line">    <span class="number">0x00</span>, <span class="number">0xC1</span>, <span class="number">0x81</span>, <span class="number">0x40</span>, <span class="number">0x01</span>, <span class="number">0xC0</span>, <span class="number">0x80</span>, <span class="number">0x41</span>, <span class="number">0x00</span>, <span class="number">0xC1</span>, <span class="number">0x81</span>, <span class="number">0x40</span>,</span><br><span class="line">    <span class="number">0x00</span>, <span class="number">0xC1</span>, <span class="number">0x81</span>, <span class="number">0x40</span>, <span class="number">0x01</span>, <span class="number">0xC0</span>, <span class="number">0x80</span>, <span class="number">0x41</span>, <span class="number">0x00</span>, <span class="number">0xC1</span>, <span class="number">0x81</span>, <span class="number">0x40</span>,</span><br><span class="line">    <span class="number">0x01</span>, <span class="number">0xC0</span>, <span class="number">0x80</span>, <span class="number">0x41</span>, <span class="number">0x01</span>, <span class="number">0xC0</span>, <span class="number">0x80</span>, <span class="number">0x41</span>, <span class="number">0x00</span>, <span class="number">0xC1</span>, <span class="number">0x81</span>, <span class="number">0x40</span>,</span><br><span class="line">    <span class="number">0x00</span>, <span class="number">0xC1</span>, <span class="number">0x81</span>, <span class="number">0x40</span>, <span class="number">0x01</span>, <span class="number">0xC0</span>, <span class="number">0x80</span>, <span class="number">0x41</span>, <span class="number">0x01</span>, <span class="number">0xC0</span>, <span class="number">0x80</span>, <span class="number">0x41</span>,</span><br><span class="line">    <span class="number">0x00</span>, <span class="number">0xC1</span>, <span class="number">0x81</span>, <span class="number">0x40</span>, <span class="number">0x01</span>, <span class="number">0xC0</span>, <span class="number">0x80</span>, <span class="number">0x41</span>, <span class="number">0x00</span>, <span class="number">0xC1</span>, <span class="number">0x81</span>, <span class="number">0x40</span>,</span><br><span class="line">    <span class="number">0x00</span>, <span class="number">0xC1</span>, <span class="number">0x81</span>, <span class="number">0x40</span>, <span class="number">0x01</span>, <span class="number">0xC0</span>, <span class="number">0x80</span>, <span class="number">0x41</span>, <span class="number">0x01</span>, <span class="number">0xC0</span>, <span class="number">0x80</span>, <span class="number">0x41</span>,</span><br><span class="line">    <span class="number">0x00</span>, <span class="number">0xC1</span>, <span class="number">0x81</span>, <span class="number">0x40</span>, <span class="number">0x00</span>, <span class="number">0xC1</span>, <span class="number">0x81</span>, <span class="number">0x40</span>, <span class="number">0x01</span>, <span class="number">0xC0</span>, <span class="number">0x80</span>, <span class="number">0x41</span>,</span><br><span class="line">    <span class="number">0x00</span>, <span class="number">0xC1</span>, <span class="number">0x81</span>, <span class="number">0x40</span>, <span class="number">0x01</span>, <span class="number">0xC0</span>, <span class="number">0x80</span>, <span class="number">0x41</span>, <span class="number">0x01</span>, <span class="number">0xC0</span>, <span class="number">0x80</span>, <span class="number">0x41</span>,</span><br><span class="line">    <span class="number">0x00</span>, <span class="number">0xC1</span>, <span class="number">0x81</span>, <span class="number">0x40</span>, <span class="number">0x00</span>, <span class="number">0xC1</span>, <span class="number">0x81</span>, <span class="number">0x40</span>, <span class="number">0x01</span>, <span class="number">0xC0</span>, <span class="number">0x80</span>, <span class="number">0x41</span>,</span><br><span class="line">    <span class="number">0x01</span>, <span class="number">0xC0</span>, <span class="number">0x80</span>, <span class="number">0x41</span>, <span class="number">0x00</span>, <span class="number">0xC1</span>, <span class="number">0x81</span>, <span class="number">0x40</span>, <span class="number">0x01</span>, <span class="number">0xC0</span>, <span class="number">0x80</span>, <span class="number">0x41</span>,</span><br><span class="line">    <span class="number">0x00</span>, <span class="number">0xC1</span>, <span class="number">0x81</span>, <span class="number">0x40</span>, <span class="number">0x00</span>, <span class="number">0xC1</span>, <span class="number">0x81</span>, <span class="number">0x40</span>, <span class="number">0x01</span>, <span class="number">0xC0</span>, <span class="number">0x80</span>, <span class="number">0x41</span>,</span><br><span class="line">    <span class="number">0x00</span>, <span class="number">0xC1</span>, <span class="number">0x81</span>, <span class="number">0x40</span>, <span class="number">0x01</span>, <span class="number">0xC0</span>, <span class="number">0x80</span>, <span class="number">0x41</span>, <span class="number">0x01</span>, <span class="number">0xC0</span>, <span class="number">0x80</span>, <span class="number">0x41</span>,</span><br><span class="line">    <span class="number">0x00</span>, <span class="number">0xC1</span>, <span class="number">0x81</span>, <span class="number">0x40</span>, <span class="number">0x01</span>, <span class="number">0xC0</span>, <span class="number">0x80</span>, <span class="number">0x41</span>, <span class="number">0x00</span>, <span class="number">0xC1</span>, <span class="number">0x81</span>, <span class="number">0x40</span>,</span><br><span class="line">    <span class="number">0x00</span>, <span class="number">0xC1</span>, <span class="number">0x81</span>, <span class="number">0x40</span>, <span class="number">0x01</span>, <span class="number">0xC0</span>, <span class="number">0x80</span>, <span class="number">0x41</span>, <span class="number">0x01</span>, <span class="number">0xC0</span>, <span class="number">0x80</span>, <span class="number">0x41</span>,</span><br><span class="line">    <span class="number">0x00</span>, <span class="number">0xC1</span>, <span class="number">0x81</span>, <span class="number">0x40</span>, <span class="number">0x00</span>, <span class="number">0xC1</span>, <span class="number">0x81</span>, <span class="number">0x40</span>, <span class="number">0x01</span>, <span class="number">0xC0</span>, <span class="number">0x80</span>, <span class="number">0x41</span>,</span><br><span class="line">    <span class="number">0x00</span>, <span class="number">0xC1</span>, <span class="number">0x81</span>, <span class="number">0x40</span>, <span class="number">0x01</span>, <span class="number">0xC0</span>, <span class="number">0x80</span>, <span class="number">0x41</span>, <span class="number">0x01</span>, <span class="number">0xC0</span>, <span class="number">0x80</span>, <span class="number">0x41</span>,</span><br><span class="line">    <span class="number">0x00</span>, <span class="number">0xC1</span>, <span class="number">0x81</span>, <span class="number">0x40</span></span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">uint8_t</span> CRCLo[] = {</span><br><span class="line">    <span class="number">0x00</span>, <span class="number">0xC0</span>, <span class="number">0xC1</span>, <span class="number">0x01</span>, <span class="number">0xC3</span>, <span class="number">0x03</span>, <span class="number">0x02</span>, <span class="number">0xC2</span>, <span class="number">0xC6</span>, <span class="number">0x06</span>, <span class="number">0x07</span>, <span class="number">0xC7</span>,</span><br><span class="line">    <span class="number">0x05</span>, <span class="number">0xC5</span>, <span class="number">0xC4</span>, <span class="number">0x04</span>, <span class="number">0xCC</span>, <span class="number">0x0C</span>, <span class="number">0x0D</span>, <span class="number">0xCD</span>, <span class="number">0x0F</span>, <span class="number">0xCF</span>, <span class="number">0xCE</span>, <span class="number">0x0E</span>,</span><br><span class="line">    <span class="number">0x0A</span>, <span class="number">0xCA</span>, <span class="number">0xCB</span>, <span class="number">0x0B</span>, <span class="number">0xC9</span>, <span class="number">0x09</span>, <span class="number">0x08</span>, <span class="number">0xC8</span>, <span class="number">0xD8</span>, <span class="number">0x18</span>, <span class="number">0x19</span>, <span class="number">0xD9</span>,</span><br><span class="line">    <span class="number">0x1B</span>, <span class="number">0xDB</span>, <span class="number">0xDA</span>, <span class="number">0x1A</span>, <span class="number">0x1E</span>, <span class="number">0xDE</span>, <span class="number">0xDF</span>, <span class="number">0x1F</span>, <span class="number">0xDD</span>, <span class="number">0x1D</span>, <span class="number">0x1C</span>, <span class="number">0xDC</span>,</span><br><span class="line">    <span class="number">0x14</span>, <span class="number">0xD4</span>, <span class="number">0xD5</span>, <span class="number">0x15</span>, <span class="number">0xD7</span>, <span class="number">0x17</span>, <span class="number">0x16</span>, <span class="number">0xD6</span>, <span class="number">0xD2</span>, <span class="number">0x12</span>, <span class="number">0x13</span>, <span class="number">0xD3</span>,</span><br><span class="line">    <span class="number">0x11</span>, <span class="number">0xD1</span>, <span class="number">0xD0</span>, <span class="number">0x10</span>, <span class="number">0xF0</span>, <span class="number">0x30</span>, <span class="number">0x31</span>, <span class="number">0xF1</span>, <span class="number">0x33</span>, <span class="number">0xF3</span>, <span class="number">0xF2</span>, <span class="number">0x32</span>,</span><br><span class="line">    <span class="number">0x36</span>, <span class="number">0xF6</span>, <span class="number">0xF7</span>, <span class="number">0x37</span>, <span class="number">0xF5</span>, <span class="number">0x35</span>, <span class="number">0x34</span>, <span class="number">0xF4</span>, <span class="number">0x3C</span>, <span class="number">0xFC</span>, <span class="number">0xFD</span>, <span class="number">0x3D</span>,</span><br><span class="line">    <span class="number">0xFF</span>, <span class="number">0x3F</span>, <span class="number">0x3E</span>, <span class="number">0xFE</span>, <span class="number">0xFA</span>, <span class="number">0x3A</span>, <span class="number">0x3B</span>, <span class="number">0xFB</span>, <span class="number">0x39</span>, <span class="number">0xF9</span>, <span class="number">0xF8</span>, <span class="number">0x38</span>,</span><br><span class="line">    <span class="number">0x28</span>, <span class="number">0xE8</span>, <span class="number">0xE9</span>, <span class="number">0x29</span>, <span class="number">0xEB</span>, <span class="number">0x2B</span>, <span class="number">0x2A</span>, <span class="number">0xEA</span>, <span class="number">0xEE</span>, <span class="number">0x2E</span>, <span class="number">0x2F</span>, <span class="number">0xEF</span>,</span><br><span class="line">    <span class="number">0x2D</span>, <span class="number">0xED</span>, <span class="number">0xEC</span>, <span class="number">0x2C</span>, <span class="number">0xE4</span>, <span class="number">0x24</span>, <span class="number">0x25</span>, <span class="number">0xE5</span>, <span class="number">0x27</span>, <span class="number">0xE7</span>, <span class="number">0xE6</span>, <span class="number">0x26</span>,</span><br><span class="line">    <span class="number">0x22</span>, <span class="number">0xE2</span>, <span class="number">0xE3</span>, <span class="number">0x23</span>, <span class="number">0xE1</span>, <span class="number">0x21</span>, <span class="number">0x20</span>, <span class="number">0xE0</span>, <span class="number">0xA0</span>, <span class="number">0x60</span>, <span class="number">0x61</span>, <span class="number">0xA1</span>,</span><br><span class="line">    <span class="number">0x63</span>, <span class="number">0xA3</span>, <span class="number">0xA2</span>, <span class="number">0x62</span>, <span class="number">0x66</span>, <span class="number">0xA6</span>, <span class="number">0xA7</span>, <span class="number">0x67</span>, <span class="number">0xA5</span>, <span class="number">0x65</span>, <span class="number">0x64</span>, <span class="number">0xA4</span>,</span><br><span class="line">    <span class="number">0x6C</span>, <span class="number">0xAC</span>, <span class="number">0xAD</span>, <span class="number">0x6D</span>, <span class="number">0xAF</span>, <span class="number">0x6F</span>, <span class="number">0x6E</span>, <span class="number">0xAE</span>, <span class="number">0xAA</span>, <span class="number">0x6A</span>, <span class="number">0x6B</span>, <span class="number">0xAB</span>,</span><br><span class="line">    <span class="number">0x69</span>, <span class="number">0xA9</span>, <span class="number">0xA8</span>, <span class="number">0x68</span>, <span class="number">0x78</span>, <span class="number">0xB8</span>, <span class="number">0xB9</span>, <span class="number">0x79</span>, <span class="number">0xBB</span>, <span class="number">0x7B</span>, <span class="number">0x7A</span>, <span class="number">0xBA</span>,</span><br><span class="line">    <span class="number">0xBE</span>, <span class="number">0x7E</span>, <span class="number">0x7F</span>, <span class="number">0xBF</span>, <span class="number">0x7D</span>, <span class="number">0xBD</span>, <span class="number">0xBC</span>, <span class="number">0x7C</span>, <span class="number">0xB4</span>, <span class="number">0x74</span>, <span class="number">0x75</span>, <span class="number">0xB5</span>,</span><br><span class="line">    <span class="number">0x77</span>, <span class="number">0xB7</span>, <span class="number">0xB6</span>, <span class="number">0x76</span>, <span class="number">0x72</span>, <span class="number">0xB2</span>, <span class="number">0xB3</span>, <span class="number">0x73</span>, <span class="number">0xB1</span>, <span class="number">0x71</span>, <span class="number">0x70</span>, <span class="number">0xB0</span>,</span><br><span class="line">    <span class="number">0x50</span>, <span class="number">0x90</span>, <span class="number">0x91</span>, <span class="number">0x51</span>, <span class="number">0x93</span>, <span class="number">0x53</span>, <span class="number">0x52</span>, <span class="number">0x92</span>, <span class="number">0x96</span>, <span class="number">0x56</span>, <span class="number">0x57</span>, <span class="number">0x97</span>,</span><br><span class="line">    <span class="number">0x55</span>, <span class="number">0x95</span>, <span class="number">0x94</span>, <span class="number">0x54</span>, <span class="number">0x9C</span>, <span class="number">0x5C</span>, <span class="number">0x5D</span>, <span class="number">0x9D</span>, <span class="number">0x5F</span>, <span class="number">0x9F</span>, <span class="number">0x9E</span>, <span class="number">0x5E</span>,</span><br><span class="line">    <span class="number">0x5A</span>, <span class="number">0x9A</span>, <span class="number">0x9B</span>, <span class="number">0x5B</span>, <span class="number">0x99</span>, <span class="number">0x59</span>, <span class="number">0x58</span>, <span class="number">0x98</span>, <span class="number">0x88</span>, <span class="number">0x48</span>, <span class="number">0x49</span>, <span class="number">0x89</span>,</span><br><span class="line">    <span class="number">0x4B</span>, <span class="number">0x8B</span>, <span class="number">0x8A</span>, <span class="number">0x4A</span>, <span class="number">0x4E</span>, <span class="number">0x8E</span>, <span class="number">0x8F</span>, <span class="number">0x4F</span>, <span class="number">0x8D</span>, <span class="number">0x4D</span>, <span class="number">0x4C</span>, <span class="number">0x8C</span>,</span><br><span class="line">    <span class="number">0x44</span>, <span class="number">0x84</span>, <span class="number">0x85</span>, <span class="number">0x45</span>, <span class="number">0x87</span>, <span class="number">0x47</span>, <span class="number">0x46</span>, <span class="number">0x86</span>, <span class="number">0x82</span>, <span class="number">0x42</span>, <span class="number">0x43</span>, <span class="number">0x83</span>,</span><br><span class="line">    <span class="number">0x41</span>, <span class="number">0x81</span>, <span class="number">0x80</span>, <span class="number">0x40</span></span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">uint16_t</span> <span class="title">CRC16</span><span class="params">( <span class="keyword">uint8_t</span> *Frame, <span class="keyword">uint16_t</span> Len )</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="keyword">uint8_t</span>        ucCRCHi = <span class="number">0xFF</span>;</span><br><span class="line">    <span class="keyword">uint8_t</span>        ucCRCLo = <span class="number">0xFF</span>;</span><br><span class="line">    <span class="keyword">int</span>                iIndex;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>( Len-- )</span><br><span class="line">    {</span><br><span class="line">        iIndex = ucCRCLo ^ *( Frame++ );</span><br><span class="line">        ucCRCLo = ( <span class="keyword">uint8_t</span> )( ucCRCHi ^ CRCHi[iIndex] );</span><br><span class="line">        ucCRCHi = CRCLo[iIndex];</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> ( <span class="keyword">uint16_t</span> )( ucCRCHi &lt;&lt; <span class="number">8</span> | ucCRCLo );</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> <span class="keyword">const</span> *argv[])</span> </span>{</span><br><span class="line">  <span class="keyword">char</span> a[] = {<span class="number">0x01</span>,<span class="number">0x02</span>,<span class="number">0x03</span>, <span class="number">0x0d</span>};</span><br><span class="line">  <span class="keyword">char</span>* temp = a;</span><br><span class="line">  <span class="keyword">uint16_t</span> c = <span class="built_in">CRC16</span>((<span class="keyword">uint8_t</span> *)temp, <span class="number">4</span>);</span><br><span class="line">  cout&lt;&lt; c &lt;&lt;endl;</span><br><span class="line">  <span class="keyword">int</span> cL= c%<span class="number">256</span> &amp; <span class="number">0xff</span>;   <span class="comment">//校验结果的低位</span></span><br><span class="line">  <span class="keyword">int</span> cH = c/ <span class="number">256</span> &amp; <span class="number">0xff</span>; <span class="comment">//校验结果的高位</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>　　后续只需对得到的高低位数据进行强制类型转换就可以插入到命令字符串中发送了~</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/5/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><span class="page-number current">6</span>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">qianxunslimg</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives">
          <span class="site-state-item-count">72</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">qianxunslimg</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
